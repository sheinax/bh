<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <!-- Linking Google Font Link For Icons --> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/css/admin/dashboard.css">
</head>
<body>
    <div class="header">
        <div class="user-account">
            <div class="user-profile">
                <img src="/image/profile-img.png" alt="profile-img">
                <div class="user-detail">
                    <h3>Admin</h3>
                    <!-- <span>Admin</span> -->
                </div>
            </div>
        </div>
    </div>
    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="/image/image.png" alt="logo">
            <h3>Title sa inyong System</h3>
        </div>
        <ul class="sidebar-links">
            <!-- <h4>Main Menu</h4> -->
            <div class="menu-separator"></div>
            <li><a href="Admindashboard"><span class="material-symbols-outlined">Dashboard</span>Dashboard</a></li>
            <li><a href="usermanagement"><span class="material-symbols-outlined">Manage_Accounts</span>Tenants</a></li>
            <li><a href="patients"><span class="material-symbols-outlined">chat</span>Messages</a></li>
            <li><a href="/login"><span class="material-symbols-outlined">Logout</span>Logout</a></li>
        </ul>
        
    </aside>


     <!-- Main Content -->
     <main class="main-content">
        <div class="sticky-header">
            <h2>Overview</h2>
        </div>
    
        <!-- Metrics Section -->
        <section class="reports-metrics">
           <div class="metrics">
            
    <div class="metrics-group">
        
        <div class="metric-box">

              <h6>Total Funds</h6>

            <!-- Month + Year Selector -->
            <div class="date-controller">
                <span class="arrow prev-month">&lt;</span>

                <div class="month-display">
                    <span class="current-month">January</span>
                    <span class="current-year trigger-year-popup">2025 ▾</span>
                </div>

                <span class="arrow next-month">&gt;</span>
            </div>

            <!-- Popup Year Selector -->
            <div class="year-popup" id="yearPopup">
                <!-- Years inserted by JS -->
            </div>


            <div class="stat-number" id="fundAmount">₱345,345</div>

            <span class="material-symbols-outlined icon-large">payments</span>
          

        </div>
    </div>
</div>

                    <div class="metric-box">
                        <h6>Total Expenses</h6>
                        <!-- <div class="stat-number" id="totalActiveStaff"> -->
                            <div class="stat-number" >  ₱45,345
                           
                        </div>
                        <span class="material-symbols-outlined icon-large"> request_quote</span>
                    </div>

                    <div class="metric-box">
                        <h6>Net Balance</h6>
                        <!-- <div class="stat-number" id="totalPatients"> -->
                           <div class="stat-number" >  ₱35,45 
                        </div>
                        <span class="material-symbols-outlined icon-large"> account_balance_wallet</span>
                    </div>
                
                    <div class="metric-box">
                        <h6>Pending Payments</h6>
                        <!-- <div class="stat-number" id="totalActivePatients"> -->
                             <div class="stat-number" >  ₱123,123
                          
                        </div>
                    <span class="material-symbols-outlined icon-large"> request_quote</span>
                    </div>
                </div>
        
                </div>
                
                
            </div>
        </section>

        <br>

           <div class="sticky-header">
            <h2>Rooms Overview</h2>
        </div>


        <section class="reports-metrics">
            <div class="metrics">
                <div class="metrics-group">
                    <div class="metric-box">
                        <h6>Total Rooms</h6>
                        <!-- <div class="stat-number" id="totalStaffUsers"> -->
                       <div class="stat-number" >100   
                        </div>
                        <span class="material-symbols-outlined icon-large"> meeting_room</span>
                    </div>
                
                    <div class="metric-box">
                        <h6>Occupied Rooms</h6>
                        <!-- <div class="stat-number" id="totalActiveStaff"> -->
                        <div class="stat-number" >  60  
                        </div>
                        <span class="material-symbols-outlined icon-large">people</span> 
                    </div>

                    <div class="metric-box">
                        <h6>Vacant Rooms</h6>
                        <!-- <div class="stat-number" id="totalPatients"> -->
                         <div class="stat-number" > 40      
                        </div>
                       <span class="material-symbols-outlined icon-large"> night_shelter</span>
                    </div>
                
                   
                
                
            </div>
        </section>
        

<br>

             <div class="sticky-header">
            <h2>Tenants Details</h2>
        </div>


         </div>
        
        

    </main>


    <script>
        // Fetch total clinic staff
        fetch('/admin/getTotalClinicStaff')
            .then(response => response.json())
            .then(data => {
                document.getElementById('totalStaffUsers').innerText = data.totalStaff;
            })
            .catch(error => {
                console.error('Error fetching total clinic staff users:', error);
                document.getElementById('totalStaffUsers').innerText = 'Error loading data';
            });

        // Fetch total number of patients
        fetch('/staff/getTotalPatients') 
            .then(response => response.json())
            .then(data => {
                document.getElementById('totalPatients').innerText = data.totalPatients;
            })
            .catch(error => {
                console.error('Error fetching total patients:', error);
                document.getElementById('totalPatients').innerText = 'Error loading data';
            });

        // Fetch total active clinic staff
        fetch('/admin/getTotalActiveClinicStaff')
            .then(response => response.json())
            .then(data => {
                document.getElementById('totalActiveStaff').innerText = data.activeStaff;
            })
            .catch(error => {
                console.error('Error fetching active clinic staff users:', error);
                document.getElementById('totalActiveStaff').innerText = 'Error loading data';
            });


        // Fetch total active patients
        fetch('/admin/getTotalActivePatients')
            .then(response => response.json())
            .then(data => {
                document.getElementById('totalActivePatients').innerText = data.activePatients;
            })
            .catch(error => {
                console.error('Error fetching active patients:', error);
                document.getElementById('totalActivePatients').innerText = 'Error loading data';
            });

            //fetch recent appointments
            fetch('/admin/getRecentAppointments')
                .then(response => response.json())
                .then(data => {
                    const appointmentsList = document.getElementById('recent-appointments-list');
                    appointmentsList.innerHTML = ''; // Clear existing content
                    if (data.length > 0) {
                        data.forEach(appointment => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${appointment.patientName}</td>
                                <td>${appointment.date}</td>
                                <td>${appointment.status}</td>
                            `;
                            appointmentsList.appendChild(row);
                        });
                    } else {
                        appointmentsList.innerHTML = '<tr><td colspan="3">No recent appointments</td></tr>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching recent appointments:', error);
                    document.getElementById('recent-appointments-list').innerHTML = '<tr><td colspan="3">Error loading appointments</td></tr>';
                });


            // Fetch recent patients from the backend
        fetch('/admin/getRecentpatients')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => updateDashboardUI(data))
            .catch(error => {
                console.error('Error fetching recent patients:', error);
                const tbody = document.getElementById('recent-patients-list');
                tbody.innerHTML = '<tr><td colspan="2">Error fetching data</td></tr>';
            });

        // Update the table with patient data
        function updateDashboardUI(patients) {
            const tbody = document.getElementById('recent-patients-list');
            tbody.innerHTML = ''; // Clear existing content

            if (patients.length > 0) {
                patients.forEach(patient => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${patient.name}</td>
                        <td>${patient.registrationDate}</td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                tbody.innerHTML = '<tr><td colspan="2">No recent patients found</td></tr>';
            }
        }


    </script>


<script>
const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
];

let currentMonthIndex = new Date().getMonth();
let currentYear = new Date().getFullYear();

const monthEl = document.querySelector('.current-month');
const yearEl = document.querySelector('.current-year');
const fundAmount = document.getElementById('fundAmount');


// YEAR POPUP
const yearPopup = document.getElementById('yearPopup');

for (let y = 2010; y <= 2035; y++) {
    let div = document.createElement("div");
    div.textContent = y;

    div.addEventListener("click", () => {
        currentYear = y;
        yearEl.textContent = currentYear + " ▾";
        yearPopup.style.display = "none";
        updateDisplay();
        loadFunds();
    });

    yearPopup.appendChild(div);
}

yearEl.addEventListener("click", () => {
    yearPopup.style.display =
        yearPopup.style.display === "block" ? "none" : "block";
});

function updateDisplay() {
    monthEl.textContent = months[currentMonthIndex];
    yearEl.textContent = currentYear + " ▾";
}

// Month navigation
document.querySelector('.prev-month').addEventListener('click', () => {
    if (currentMonthIndex === 0) {
        currentMonthIndex = 11;
        currentYear--;
    } else {
        currentMonthIndex--;
    }
    updateDisplay();
    loadFunds();
});

document.querySelector('.next-month').addEventListener('click', () => {
    if (currentMonthIndex === 11) {
        currentMonthIndex = 0;
        currentYear++;
    } else {
        currentMonthIndex++;
    }
    updateDisplay();
    loadFunds();
});

// AUTO-LOAD FUNDS (Replace with API)
function loadFunds() {
    // Example only — you will connect to DB later
    const randomAmount = Math.floor(Math.random() * 900000) + 10000;

    fundAmount.textContent = "₱" + randomAmount.toLocaleString();
}

updateDisplay();
loadFunds();
</script>

</body>
</html>
