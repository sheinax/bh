<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <!-- Linking Google Font Link For Icons --> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/css/admin/dashboard.css">
</head>
<body>
    <div class="header">
        <div class="user-account">
            <div class="user-profile">
                <img src="/image/profile-img.png" alt="profile-img">
                <div class="user-detail">
                    <h3>Admin</h3>
                    <!-- <span>Admin</span> -->
                </div>
            </div>
        </div>
    </div>
    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="/image/logo.png" alt="logo">
          <h3>BH Payment Monitoring </h3>
        </div>
        <ul class="sidebar-links">
            <!-- <h4>Main Menu</h4> -->
            <div class="menu-separator"></div>
            <li><a href="Admindashboard"><span class="material-symbols-outlined">Dashboard</span>Dashboard</a></li>
            <li><a href="usermanagement"><span class="material-symbols-outlined">Manage_Accounts</span>Tenants</a></li>
            <li><a href="room"><span class="material-symbols-outlined">room_preferences</span>Room</a></li>
            <li><a href="payment"><span class="material-symbols-outlined">payments</span>Payment</a></li>
            <li><a href="message"><span class="material-symbols-outlined">chat</span>Messages</a></li>
            <li><a href="/login"><span class="material-symbols-outlined">Logout</span>Logout</a></li>
        </ul>
        
    </aside>


     <!-- Main Content -->
     <main class="main-content">
        <div class="sticky-header">
            <h2>Dashboard</h2>
        </div>
    
        <!-- Metrics Section -->
        <section class="reports-metrics">
           <div class="metrics">
            
    <div class="metrics-group">
        
        <div class="metric-box">

              <h6>Total Funds</h6>

            <!-- Month + Year Selector -->
            <div class="date-controller">
                <span class="arrow prev-month">&lt;</span>

                <div class="month-display">
                    <span class="current-month">January</span>
                    <span class="current-year trigger-year-popup">2025 ▾</span>
                </div>

                <span class="arrow next-month">&gt;</span>
            </div>

            <!-- Popup Year Selector -->
            <div class="year-popup" id="yearPopup">
                <!-- Years inserted by JS -->
            </div>


            <div class="stat-number" id="fundAmount">₱345,345</div>

            <!-- <span class="material-symbols-outlined icon-large">payments</span> -->
          

        </div>
    </div>


                
                    <div class="metric-box">
                        <h6>Pending Payments</h6>
                        <!-- <div class="stat-number" id="totalActivePatients"> -->
                             <div class="stat-number" >  ₱123,123
                          
                        </div>
                    <span class="material-symbols-outlined icon-large"> request_quote</span>
                    </div>


                    
                    <div class="metric-box">
                        <h6>Total Active Tenants</h6>
                        <div class="stat-number" id="totalActiveTenants">
                            <span>Loading...</span>
                        </div>
                        <span class="material-symbols-outlined icon-large">people</span> 
                    </div>
                </div>
        
                
                
            </div>
        </section>

        <br>
        <br>

           <div class="sticky-header">
            <h2>Rooms Overview</h2>
        </div>


    <section class="reports-metrics">
    <div class="metrics">
        <div class="metrics-group">
           <div class="metric-box">
    <h6>Total Rooms</h6>
    <div class="stat-number" id="totalRooms">Loading...</div>
    <span class="material-symbols-outlined icon-large">meeting_room</span>

</div>

<script>
fetch('/admin/getTotalRooms')
    .then(res => res.json())
    .then(data => {
        document.getElementById('totalRooms').innerText = data.totalRooms;
    })
    .catch(err => {
        console.error('Error fetching total rooms:', err);
        document.getElementById('totalRooms').innerText = 'Error';
    });
</script>


          <div class="metric-box">
    <h6>Occupied Rooms</h6>
    <div class="stat-number" id="occupiedRooms">Loading...</div>
</div>

<div class="metric-box">
    <h6>Available Rooms</h6>
    <div class="stat-number" id="availableRooms">Loading...</div>
</div>


<script>
fetch('/admin/getRoomStats')
    .then(res => res.json())
    .then(data => {
        // Occupied rooms
        const occupiedEl = document.getElementById('occupiedRooms');
        let occupiedHtml = `${Object.values(data.occupied).reduce((a,b)=>a+b,0)}<div class="room-types">`;
        for (const [type, count] of Object.entries(data.occupied)) {
            occupiedHtml += `<p>${type}: ${count}</p>`;
        }
        occupiedHtml += `</div>`;
        occupiedEl.innerHTML = occupiedHtml;

        // Available rooms
        const availableEl = document.getElementById('availableRooms');
        let availableHtml = `${Object.values(data.available).reduce((a,b)=>a+b,0)}<div class="room-types">`;
        for (const [type, count] of Object.entries(data.available)) {
            availableHtml += `<p>${type}: ${count}</p>`;
        }
        availableHtml += `</div>`;
        availableEl.innerHTML = availableHtml;
    })
    .catch(err => {
        console.error('Error fetching room stats:', err);
        document.getElementById('occupiedRooms').innerText = 'Error';
        document.getElementById('availableRooms').innerText = 'Error';
    });
</script>

</section>


<br>

<br>

        
        

    </main>




<script>
const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
];

let currentMonthIndex = new Date().getMonth();
let currentYear = new Date().getFullYear();

const monthEl = document.querySelector('.current-month');
const yearEl = document.querySelector('.current-year');
const fundAmount = document.getElementById('fundAmount');


// YEAR POPUP
const yearPopup = document.getElementById('yearPopup');

for (let y = 2010; y <= 2035; y++) {
    let div = document.createElement("div");
    div.textContent = y;

    div.addEventListener("click", () => {
        currentYear = y;
        yearEl.textContent = currentYear + " ▾";
        yearPopup.style.display = "none";
        updateDisplay();
        loadFunds();
    });

    yearPopup.appendChild(div);
}

yearEl.addEventListener("click", () => {
    yearPopup.style.display =
        yearPopup.style.display === "block" ? "none" : "block";
});

function updateDisplay() {
    monthEl.textContent = months[currentMonthIndex];
    yearEl.textContent = currentYear + " ▾";
}

// Month navigation
document.querySelector('.prev-month').addEventListener('click', () => {
    if (currentMonthIndex === 0) {
        currentMonthIndex = 11;
        currentYear--;
    } else {
        currentMonthIndex--;
    }
    updateDisplay();
    loadFunds();
});

document.querySelector('.next-month').addEventListener('click', () => {
    if (currentMonthIndex === 11) {
        currentMonthIndex = 0;
        currentYear++;
    } else {
        currentMonthIndex++;
    }
    updateDisplay();
    loadFunds();
});

// AUTO-LOAD FUNDS (Replace with API)
function loadFunds() {
    // Example only — you will connect to DB later
    const randomAmount = Math.floor(Math.random() * 900000) + 10000;

    fundAmount.textContent = "₱" + randomAmount.toLocaleString();
}

updateDisplay();
loadFunds();
</script>



<script>
    // Fetch total active tenants
    fetch('/admin/getTotalActiveTenants')
        .then(response => response.json())
        .then(data => {
            document.getElementById('totalActiveTenants').innerText = data.totalActiveTenants;
        })
        .catch(error => {
            console.error('Error fetching active tenant users:', error);
            document.getElementById('totalActiveTenants').innerText = 'Error loading data';
        });
</script>


</body>
</html>
