<!-- usermanagement.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Management</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="stylesheet" href="/css/admin/usermanagement.css">
</head>
<body>

 <div class="header">
 
    <!-- Notifications -->
    <div class="notifications">
        <span class="material-symbols-outlined" id="notifIcon">notifications</span>
        <div class="notif-count" id="notifCount">3</div>
    </div>

    
    <!-- User Account -->
    <div class="user-account">
        <div class="user-profile">
            <img src="/image/profile-img.png" alt="profile-img">
            <div class="user-detail">
                <h3>Aileen Mercado</h3>
                <span>Landlord</span>
            </div>
        </div>
    </div>
</div>

<!-- Notification Popup -->
<div class="notif-popup" id="notifPopup">
    <div class="notif-popup-header">
        <h4>Notifications</h4>
        <span id="closeNotif">&times;</span>
    </div>
    <div class="notif-popup-body">
        <p class="notif-item">New payment received from Juan Dela Cruz</p>
        <p class="notif-item">Room 101 is now available</p>
        <p class="notif-item">Tenant Maria updated profile</p>
    </div>
    <div class="notif-popup-footer">
        <p class="view-all">View all notifications</p>
    </div>
</div>


<aside class="sidebar">
    <div class="sidebar-header">
        <img src="/image/logo.png" alt="logo">
        <h3>BH Payment Monitoring </h3>
    </div>
    <ul class="sidebar-links">
        <div class="menu-separator"></div>
        <li><a href="Admindashboard"><span class="material-symbols-outlined">Dashboard</span>Dashboard</a></li>
        <li><a href="usermanagement"><span class="material-symbols-outlined">Manage_Accounts</span>Tenants</a></li>
        <li><a href="room"><span class="material-symbols-outlined">room_preferences</span>Room</a></li>
        <li><a href="payment"><span class="material-symbols-outlined">payments</span>Deposit</a></li>
         <li><a href="monthlypayment"><span class="material-symbols-outlined">money</span>Monthly Payment</a></li>
        
        <li class="messages">
    <a href="message" class="messages-link">
        <span class="material-symbols-outlined" id="messageIcon">chat</span>
        Messages
        <span class="msg-count" id="msgCount">5</span>
    </a>
</li>
        <li><a href="/login"><span class="material-symbols-outlined">Logout</span>Logout</a></li>
    </ul>
</aside>

<main class="main-content">
    <div class="top">
        <div class="sticky-header"><h4>Tenant Management</h4></div>    

        <div class="add-search">
            <button id="addUserBtn" class="btn btn-add">
                <span class="material-symbols-outlined">person_add</span> Add New Tenant
            </button>

            <div class="search-container">
                <span class="material-icons search-icon">search</span>
                <input type="text" id="searchInput" placeholder="Search">
            </div>

            <div class="filter-container">
                <label for="statusFilter">Filter by Status:</label>
                <select id="statusFilter">
                    <option value="All">All</option>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close">&times;</span>
            <h3>Add New Tenant</h3>

            <form id="addUserForm" method="post" action="/admin/addUser">
                <div class="form-group"><label>Lastname:</label>
                    <input name="lastName_data" type="text" class="form-control" required></div>

                <div class="form-group"><label>Firstname:</label>
                    <input name="firstName_data" type="text" class="form-control" required></div>

                <div class="form-group"><label>Address:</label>
                    <input name="address_data" type="text" class="form-control" required></div>

                <div class="form-group"><label>Gender:</label>
                    <select name="gender_data" class="form-control" required>
                        <option value="">Select</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select></div>

                <div class="form-group"><label>Contact Number:</label>
                    <input name="contactNumber_data" type="tel" class="form-control" pattern="[0-9]{11}" maxlength="11" required></div>

             <div class="form-group">
                <label>Room Type:</label>
                <select name="roomType_data" class="form-control" required>
                    <option value="">Select</option>
                    <option value="Bed Spacer">Bed Spacer</option>
                    <option value="Regular">Regular</option>
                </select>
            </div>

                <div class="form-group"><label>Room Number:</label>
                    <input name="roomNumber_data" type="number" class="form-control" required></div>

                <div class="form-group"><label>Monthly Rent:</label>
                    <input name="monthlyRent_data" type="number" class="form-control" step="0.01" required></div>

                <div class="form-group"><label>Status:</label>
                    <input name="status" type="text" class="form-control" value="Active" readonly></div>

                <div class="form-group"><label>Username:</label>
                    <input name="Username_data" type="text" class="form-control" required></div>

                <div class="form-group"><label>Password:</label>
                    <input name="Password_data" type="password" class="form-control" required></div>

                <button type="submit" class="btn btn-success">Save</button>
            </form>
        </div>
    </div>

    <!-- Edit User Modal -->
<div id="editUserModal" class="modal">
    <div class="modal-content">
        <span id="closeEditModal" class="close">&times;</span>
        <h3>Edit Tenant</h3>
        <form id="editUserForm" method="post">
            <div class="form-group"><label>Lastname:</label>
                <input name="lastName_data" type="text" class="form-control" id="editLastName" required></div>

            <div class="form-group"><label>Firstname:</label>
                <input name="firstName_data" type="text" class="form-control" id="editFirstName" required></div>

            <div class="form-group"><label>Contact Number:</label>
                <input name="contactNumber_data" type="tel" class="form-control" id="editContactNumber" pattern="[0-9]{11}" maxlength="11" required></div>

                <div class="form-group">
                <label>Room Type:</label>
                <select name="roomType_data" class="form-control" id="editRoomType" required>
                    <option value="">Select</option>
                    <option value="Bed Spacer">Bed Spacer</option>
                    <option value="Regular">Regular</option>
                </select>
            </div>

            <div class="form-group"><label>Room Number:</label>
                <input name="roomNumber_data" type="number" class="form-control" id="editRoomNumber" required></div>

            <div class="form-group"><label>Monthly Rent:</label>
                <input name="monthlyRent_data" type="number" class="form-control" id="editMonthlyRent" step="0.01" required></div>

            <div class="form-group"><label>Status:</label>
                <select name="status" class="form-control" id="editStatus" required>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                </select></div>

            <button type="submit" class="btn btn-success">Save Changes</button>
        </form>
    </div>
</div>

    <!-- User Table -->
    <div class="table-responsive">
        <table class="reports-table">
            <thead>
                <tr>
                    <th>Lastname</th>
                    <th>Firstname</th>
                    <th>Address</th>
                    <th>Gender</th>
                    <th>Contact Number</th>
                    <th>Room Type</th>
                    <th>Room Number</th>
                    <th>Monthly Rent</th>
                    <th>Username</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="userTableBody">
                <% users.forEach(user => { %>
                    <tr>
                        <td><%= user.LastName %></td>
                        <td><%= user.FirstName %></td>
                        <td><%= user.Address %></td>
                        <td><%= user.Users_Gender %></td>
                        <td><%= user.ContactNumber %></td>
                        <td><%= user.Room_Type %></td>
                        <td><%= user.Room_Number %></td>
                        <td>₱<%= Number(user.Monthly_Rent).toLocaleString() %></td>
                        <td><%= user.Username %></td>
                        <td><%= user.Users_Status %></td>
                        <td>
                            <a href="#" class="btn btn-edit" data-id="<%= user.Users_ID %>">
                                <span class="material-symbols-outlined">edit_square</span>
                            </a>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
</main>

<script>
// Add User Modal
const userModal = document.getElementById("userModal");
document.getElementById("addUserBtn").onclick = () => userModal.style.display = "block";
document.getElementById("closeModal").onclick = () => userModal.style.display = "none";
window.onclick = (event) => { if(event.target==userModal) userModal.style.display="none"; };

// Filter & Search
document.getElementById("statusFilter").addEventListener("change", function() {
    const filter=this.value;
    document.querySelectorAll("#userTableBody tr").forEach(row => {
        const status = row.children[9].textContent;
        row.style.display = (filter==="All" || status===filter) ? "" : "none";
    });
});
document.getElementById("searchInput").addEventListener("keyup", function() {
    const filter=this.value.toLowerCase();
    document.querySelectorAll("#userTableBody tr").forEach(row => {
        const match=Array.from(row.children).some(td=>td.textContent.toLowerCase().includes(filter));
        row.style.display = match ? "" : "none";
    });
});
</script>

<script>
    
    // Edit User Modal
const editUserModal = document.getElementById("editUserModal");
const editUserForm = document.getElementById("editUserForm");
document.getElementById("closeEditModal").onclick = () => editUserModal.style.display="none";

document.querySelectorAll(".btn-edit").forEach(btn => {
    btn.addEventListener("click", function(e){
        e.preventDefault();
        const row = this.closest("tr");
        const userId = this.dataset.id;

        document.getElementById("editLastName").value = row.children[0].textContent;
        document.getElementById("editFirstName").value = row.children[1].textContent;
        document.getElementById("editContactNumber").value = row.children[4].textContent;
        document.getElementById("editRoomType").value = row.children[5].textContent; // Set dropdown value
        document.getElementById("editRoomNumber").value = row.children[6].textContent;
       document.getElementById("editMonthlyRent").value = row.children[7].textContent.replace("₱", "").replace(/,/g, "");

       document.getElementById("editStatus").value = row.children[9].textContent;

        editUserForm.action = `/admin/updateUser/${userId}`;
        editUserModal.style.display = "block";
    });
});

// Close modal when clicking outside
window.onclick = (event) => {
    if(event.target === editUserModal) editUserModal.style.display="none";
};

</script>




<script>
const notifIcon = document.getElementById('notifIcon');
const notifPopup = document.getElementById('notifPopup');
const closeNotif = document.getElementById('closeNotif');

notifIcon.addEventListener('click', () => {
    notifPopup.style.display = 'block';
});

closeNotif.addEventListener('click', () => {
    notifPopup.style.display = 'none';
});

// Close popup if clicked outside
window.addEventListener('click', (e) => {
    if (e.target === notifPopup) return;
    if (!notifPopup.contains(e.target) && e.target !== notifIcon) {
        notifPopup.style.display = 'none';
    }
});
</script>

</body>
</html>
