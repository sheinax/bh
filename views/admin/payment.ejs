<!-- payment.ejs -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Payment</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/css/admin/payment.css">
</head>
<body>
   <div class="header">

    <!-- Notifications -->
    <div class="notifications">
        <span class="material-symbols-outlined" id="notifIcon">notifications</span>
        <div class="notif-count" id="notifCount">3</div>
    </div>

    
    <!-- User Account -->
    <div class="user-account">
        <div class="user-profile">
            <img src="/image/profile-img.png" alt="profile-img">
            <div class="user-detail">
                <h3>Aileen Mercado</h3>
                <span>Landlord</span>
            </div>
        </div>
    </div>
</div>

<!-- Notification Popup -->
<div class="notif-popup" id="notifPopup">
    <div class="notif-popup-header">
        <h4>Notifications</h4>
        <span id="closeNotif">&times;</span>
    </div>
    <div class="notif-popup-body">
        <p class="notif-item">New payment received from Juan Dela Cruz</p>
        <p class="notif-item">Room 101 is now available</p>
        <p class="notif-item">Tenant Maria updated profile</p>
    </div>
    <div class="notif-popup-footer">
        <p class="view-all">View all notifications</p>
    </div>
</div>


    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="/image/logo.png" alt="logo">
            <h3>BH Payment Monitoring </h3>
        </div>
        <ul class="sidebar-links">
            <!-- <h4>Main Menu</h4> -->
            <div class="menu-separator"></div>
            <li><a href="Admindashboard"><span class="material-symbols-outlined">Dashboard</span>Dashboard</a></li>
            <li><a href="usermanagement"><span class="material-symbols-outlined">Manage_Accounts</span>Tenants</a></li>
            <li><a href="room"><span class="material-symbols-outlined">room_preferences</span>Room</a></li>
            <li><a href="payment"><span class="material-symbols-outlined">payments</span>Deposit</a></li>
            <li><a href="monthlypayment"><span class="material-symbols-outlined">money</span>Monthly Payment</a></li>
      
            <li class="messages">
    <a href="message" class="messages-link">
        <span class="material-symbols-outlined" id="messageIcon">chat</span>
        Messages
        <span class="msg-count" id="msgCount">5</span>
    </a>
</li>
            <li><a href="/login"><span class="material-symbols-outlined">Logout</span>Logout</a></li>
        </ul>
        
    </aside>
<main class="main-content">
    <div class="top">
        <div class="sticky-header">
            <!-- <h4>Payment</h4>     -->
        </div>    
    </div>

    <!-- ADD DEPOSIT MODAL -->
    <div id="addDepositModal" class="modal">
        <form action="/admin/addDeposit" method="POST" class="modal-content">
            <h3>Add Deposit</h3>

            <label>Tenant Name</label>
            <input type="text" name="tenant_name" required>

            <label>Deposit Amount</label>
            <input type="number" name="deposit_amount" step="0.01" required>

            <label>Partial Deposit</label>
            <input type="number" name="partial_deposit" step="0.01">

            <button type="submit" class="btn-save">Save</button>
            <button type="button" class="btn-close" onclick="closeModal()">Cancel</button>
        </form>
    </div>

    <!-- Deposit Table -->
    <section class="table-section">
        <h5>Tenant Deposits</h5>
        <div class="table-header"> 
            <button class="btn-add" onclick="openModal()">
                <span class="material-symbols-outlined">add</span>
        Add Deposit
            </button>
        </div>


      <table class="payment-table">
  <thead>
    <tr>

      <th>Partial Date </th>
      <th>Tenant Name</th>
      <th>Deposit Amount</th>
      <th>Partial Deposit</th>
      <th>Balance Deposit</th>
      <th>Payment Status</th>
      <th>Date Paid</th>

     
      <th>Action</th>
    </tr>
  </thead>


 <tbody id="deposit-table-body">
    <% if (Array.isArray(deposits) && deposits.length > 0) { %>
        <% deposits.forEach(dep => { %>
            <tr>

                <td><%= dep.createdAt.toLocaleDateString() %></td>
                <td><%= dep.tenant_name %></td>
                <td><%= dep.deposit_amount %></td>
                <td><%= dep.partial_deposit || 0 %></td>
                <td ><%= dep.deposit_amount - (dep.partial_deposit || 0) %></td>
                <td class="<%= dep.payment_status.toLowerCase() %>">
  <%= dep.payment_status %>
</td>

                <td>
    <% if (dep.payment_status === 'Paid') { %>
        <%= dep.updatedAt.toLocaleDateString() %>
    <% } else { %>
        —
    <% } %>
</td>

    <td>
    <% if (dep.payment_status === 'Partial') { %>
        <form action="/admin/markAsPaid/<%= dep.id %>" method="POST" 
              onsubmit="return confirmMarkAsPaid();"
              style="display:inline;">
            <button type="submit" class="btn-paid">Mark as Paid</button>
        </form>
    <% } else { %>
        <span class="status-done">—</span>
    <% } %>
</td>


            </tr>
        <% }) %>
    <% } else { %>
        <tr>
            <td colspan="6" class="text-center">No records found</td>
        </tr>
    <% } %>
</tbody>


</table>

<div id="pagination" class="pagination"></div>


    </section>
</main>

<script>
function confirmMarkAsPaid() {
    return confirm("Are you sure you want to mark this deposit as PAID? The balance will be set to zero.");
}
</script>

<script>
function openModal() {
    document.getElementById('addDepositModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('addDepositModal').style.display = 'none';
}
</script>


<script>
const notifIcon = document.getElementById('notifIcon');
const notifPopup = document.getElementById('notifPopup');
const closeNotif = document.getElementById('closeNotif');

notifIcon.addEventListener('click', () => {
    notifPopup.style.display = 'block';
});

closeNotif.addEventListener('click', () => {
    notifPopup.style.display = 'none';
});

// Close popup if clicked outside
window.addEventListener('click', (e) => {
    if (e.target === notifPopup) return;
    if (!notifPopup.contains(e.target) && e.target !== notifIcon) {
        notifPopup.style.display = 'none';
    }
});
</script>

<script>
// PAGINATION
const rowsPerPage = 6;
const table = document.querySelector('.payment-table tbody');
const pagination = document.getElementById('pagination');
let currentPage = 1;

// Get all rows as array
const rows = Array.from(table.querySelectorAll('tr'));
const totalPages = Math.ceil(rows.length / rowsPerPage);

function displayTablePage(page) {
    const start = (page - 1) * rowsPerPage;
    const end = start + rowsPerPage;

    rows.forEach((row, index) => {
        row.style.display = (index >= start && index < end) ? '' : 'none';
    });

    renderPagination();
}

function renderPagination() {
    pagination.innerHTML = '';

    for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.innerText = i;
        btn.classList.add('page-btn');
        if (i === currentPage) btn.classList.add('active');

        btn.addEventListener('click', () => {
            currentPage = i;
            displayTablePage(currentPage);
        });

        pagination.appendChild(btn);
    }
}

// Initial display
displayTablePage(currentPage);
</script>




</body>

</html>
       